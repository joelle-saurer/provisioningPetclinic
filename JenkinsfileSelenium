pipeline{
    
    agent any
 
    tools {
        maven "Maven"
    }

    stages {   
        stage('Startup virtual machine with Terraform') {
            steps{ 
                sh 'cd /home/joelle/provisioning/Terraform/; terraform init; terraform apply -auto-approve'
            }
        }

        stage('Functional test of web application') { 
                    steps {
                    
                        echo 'Running the Selenium test'
                        sh "pytest -s -v --html=report.html '/home/joelle/petclinic/test_petclinic.py'"
                    }
                }    
            }
        }  
        
        stage('Destroy Terraform VM') { 
            steps{
                sh 'cd /home/azureuser/Provisioning/Terraform/; terraform destroy -auto-approve'
            }
        }      
    }
}