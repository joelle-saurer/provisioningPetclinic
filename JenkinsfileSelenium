pipeline{
    
    agent any
 
    tools {
        maven "Maven"
    }

    stages {   
        stage('Launch petclinic') { 
            parallel{
                stage('start AWS server') { 
                    steps {
                        echo 'Starting the AWS dev server using ansible tool'
                
                        sh 'cd /home/azureuser/Provisioning/ansible/; ansible-playbook main.yml'

                    }
                }
               
                stage('Functional test of web application') { 
                    steps {
                        sh 'cd /home/azureuser/petclinic/spring-framework-petclinic; ./wait'
                        echo 'Running the Selenium test'
                        sh "python3 '/home/azureuser/Provisioning/test_petclinic.py'"
                    }
                }    
            }
        }       
    }
}